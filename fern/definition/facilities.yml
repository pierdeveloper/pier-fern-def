# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

docs: |
  A facility represents an active loan or line of credit. 
  It contains references to the borrower, application and executed loan as well as the terms and other state information about the credit facility. 
  Facilities are used by Pier's system for servicing, credit reporting and other down stream functionality.

imports:
  commons: commons.yml
  applications: applications.yml
  borrowers: borrowers.yml
  loan-agreements: loan-agreements.yml
  payments: payments.yml

service:
  base-path: /facilities
  auth: true
  endpoints:
    create:
      display-name: Create a facility
      docs:
        A facility can be created for a given loan agreement with a status of
        `signed`
      path: ""
      method: POST
      request:
        name: CreateFacilityRequest
        body:
          properties:
            loan_agreement_id:
              type: loan-agreements.LoanAgreementId
              docs: The `loan_agreement_id` of the loan agreement to create a facility for
      response: Facility
      errors:
        - commons.FacilityCannotBeCreatedError
        - commons.FacilityAlreadyExistsError
        - commons.DocumentNotFoundError
        - commons.ProductNotSupportedError
      examples:
        - request:
            loan_agreement_id: $loan-agreements.LoanAgreementId.Example0
          response:
            body: $Facility.Active

    disburse:
      display-name: Create a disbursement for a facility
      docs: Create a disbursement for a facility. If disbursements_ach_enabled is false, use none for transfer_type.
      path: "/{facility_id}/disbursements"
      path-parameters:
        facility_id: FacilityId
      method: POST
      request: DisbursementRequest
      response: Disbursement
      errors:
        - commons.InvalidInputError
        - commons.FacilityNotFoundError
        - commons.LedgeringNotSupportedError
        - commons.DisbursementAchDisabledError
        - commons.DisbursementAmountExceedsFacilityAmountError
        - commons.DisbursementAmountExceedsAvailableLimitError
        - commons.MissingDisbursementBankDetails
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
          request: $DisbursementRequest.Default
          response:
            body: $Disbursement.Pending
        - path-parameters:
            facility_id: $FacilityId.Example0
          request: $DisbursementRequest.DefaultNoneType
          response:
            body: $Disbursement.PendingNoneType

    disbursementTestInitiate:
      display-name: Move disbursement to initiated state
      docs: Move disbursement to initiated state (*sandbox only*)
      path: "/{facility_id}/disbursements/{disbursement_id}/test/initiate"
      path-parameters:
        facility_id: FacilityId
        disbursement_id: DisbursementId
      method: PATCH
      response: string
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
            disbursement_id: $DisbursementId.Example0
          response:
            body: "Ok."

    disbursementTestSuccess:
      display-name: Move disbursement to successful state
      docs: Move disbursement to successful state (*sandbox only*)
      path: "/{facility_id}/disbursements/{disbursement_id}/test/success"
      path-parameters:
        facility_id: FacilityId
        disbursement_id: DisbursementId
      method: PATCH
      response: string
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
            disbursement_id: $DisbursementId.Example0
          response:
            body: "Ok."

    disbursementTestFailed:
      display-name: Move disbursement to failed state
      docs: Move disbursement to failed state (*sandbox only*)
      path: "/{facility_id}/disbursements/{disbursement_id}/test/failed"
      path-parameters:
        facility_id: FacilityId
        disbursement_id: DisbursementId
      method: PATCH
      response: string
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
            disbursement_id: $DisbursementId.Example0
          response:
            body: "Ok."

    createLimitReductionNotice:
        display-name: Create a limit reduction notice
        docs: Create a limit reduction notice, which should be presented to the user when their credit limit is reduced. This endpoint must be called before reducing the credit limit. The document_id returned should be stored and used in the PATCH /facilities/{facility_id}/update_limit endpoint.
        path: "/{facility_id}/create_limit_reduction_notice"
        path-parameters:
          facility_id: FacilityId
        method: POST
        request:
          name: CreateLimitReductionNoticeRequest
          body:
              properties:
                new_limit_amount:
                    type: integer
                    docs: Amount of the new credit limit, in cents
                reasons:
                    type: list<LimitReductionReasons>
                    docs: The reasons for the limit reduction
        response: Document
        errors:
          - commons.FacilityNotFoundError
          - commons.InvalidInputError
        examples:
            - path-parameters:
                facility_id: $FacilityId.Example0
              request:
                  new_limit_amount: 100000
                  reasons: ["fraud_prevention"]
              response:
                  body: $Document.ExampleDocument

    updateCreditLimit:
      display-name: Update credit limit for a line of credit
      docs: Update credit limit for a line of credit. For reductions, pass in the document_id from the create_limit_reduction_notice endpoint. For increases, pass in the new credit limit amount.
      path: "/{facility_id}/update_limit"
      path-parameters:
        facility_id: FacilityId
      method: PATCH
      request:
          name: UpdateCreditLimitRequest
          body:
            properties:
                new_limit_amount:
                  type: optional<integer>
                  docs: The new credit limit amount, in cents
                document_id:
                  type: optional<string>
                  docs: The document_id from the create_limit_reduction_notice endpoint
      response: Facility
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
          request:
            new_limit_amount: 100000
          response:
            body: $Facility.Active

    listPayments:
      display-name: List all payments for a facility
      docs: List payments for a facility
      path: "/{facility_id}/payments"
      path-parameters:
        facility_id: FacilityId
      method: GET
      response: list<payments.Payment>
      examples:
        - path-parameters:
            facility_id: "facility_id"
          response:
            body:
              - $payments.Payment.Pending
              - $payments.Payment.Processing

    credit:
      display-name: Credit a facility
      docs: Credit a facility
      path: "/{facility_id}/credit"
      path-parameters:
          facility_id: FacilityId
      method: POST
      request:
          name: CreditFacilityRequest
          body:
            properties:
                amount:
                  type: integer
                  docs: The amount to credit the facility, in cents (e.g. 1000 = $10.00)
                memo:
                  type: optional<string>
                  docs: A memo to attach to the credit
                original_disbursement_id:
                  type: optional<DisbursementId>
                  docs: Disbursement ID associated with the credit action (if applicable)
                original_payment_id:
                  type: optional<payments.PaymentId>
                  docs: Payment ID associated with the credit action (if applicable)
      response: RefundedPayment
      errors:
          - commons.InvalidInputError
          - commons.FacilityNotFoundError
          - commons.DisbursementNotFoundError
          - commons.PaymentNotFoundError

    refundDisbursement:
      display-name: Refund a disbursement
      docs: |
        Refunds a specified disbursement in full. This endpoint is intended for correcting erroneous transactions.
      path: "/{facility_id}/disbursements/{disbursement_id}/refund"
      path-parameters:
        facility_id: FacilityId
        disbursement_id: DisbursementId
      method: POST
      response: RefundedDisbursement
      errors:
        - commons.FacilityNotFoundError
        - commons.TransactionNotFoundError
        - commons.TransactionAlreadyRefundedError
        - commons.InvalidInputError

    close:
      display-name: Close a facility
      docs: Closes an active facility by setting its status to `closed`
      path: /{facility_id}/close
      path-parameters:
        facility_id: FacilityId
      method: POST
      response: Facility
      errors:
        - commons.FacilityNotFoundError
        - commons.FacilityCannotBeClosedError
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
          request:
          response:
            body: $Facility.Closed

    createACHAuthorization:
      display-name: Create ACH Authorization
      docs: |
        Creates an unsigned ACH authorization document for a specified facility. This is a required step before submitting a payment if repayment ACH is enabled. The user must agree to ACH withdrawals before Pier can initiate payments. This document is automatically signed by the user when you call POST /payments. You must create a new ACH authorization document for each payment.
      path: /{facility_id}/create_ach_authorization
      path-parameters:
        facility_id: FacilityId
      method: POST
      response: Document
      errors:
        - commons.InvalidInputError
        - commons.FacilityNotFoundError
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
          response:
            body: $Document.ExampleDocument

    createAutopayAuthorization:
      display-name: Create autopay ACH authorization
      docs: |
        Creates an unsigned autopay ACH authorization document for a specified facility. This is a required step before enabling autopay. The user must agree to automatic ACH withdrawals before Pier can initiate payments. This document is automatically signed by the user when you call POST /enable_autopay.
      path: /{facility_id}/create_autopay_authorization
      path-parameters:
        facility_id: FacilityId
      method: POST
      response: Facility
      errors:
        - commons.InvalidInputError
        - commons.FacilityNotFoundError
      examples:
        - path-parameters:
              facility_id: $FacilityId.Example0
          response:
            body:
              terms:
                grace_period:
                  term: 0
                  interest_rate: 0
                introductory_promo_period:
                  interest_rate: 0
                  promo_term:
                    term: 90
                    term_type: daily
                amount: 100000
                apr: 200
                annual_fee: 0
                type: "revolving_line_of_credit_offer"
                interest_rate: 200
                late_payment_fee: 0
                origination_fee: 0
                id: "off_2e60b8c4fb7e4a10835e5a7e0641a5d8"
                minimum_payment:
                  type: "interest_plus_percentage_of_principal"
                  value: 250
                  floor: 1500
              id: $FacilityId.Example0
              application_id: "app_25fbcb8b8bd2417fab99b184678d2437"
              borrower_id: "bor_39addd1e5d7241cfa758e12388cd2fd4"
              loan_agreement_id: "doc_aac8a211dd9f49229dae022c5ecddccd"
              account_number: "652633487"
              credit_type: "consumer_revolving_line_of_credit"
              status: "active"
              autopay:
                authorized: false
              balance: 0
              balances:
                current_balance: 0
                principal_balance: 0
                interest_balance: 0
                payoff_balance: 0
              origination_date: "2024-04-19"
              remaining_statement_balance: 7500
              documents:
                unsigned_autopay_ach_authorization:
                  document_url: "https://storage.googleapis.com/download/storage/v1/b/pier_loan_docs/o/test%2Fdoc_db4efb43d1c0435ba5d730927d156fa6_unsigned.pdf?generation=1714045339730396&alt=media"
                  document_id: "doc_db4efb43d1c0435ba5d730927d156fa6"
              created_on: "2024-04-25T11:38:54.520Z"
              transactions: $FacilityTransactionItems.Default
              statements:
                - $Statement.Default
              payments_due: $PaymentsDue.Default
              remaining_minimum_balance: 7500
              in_grace_period: true
              in_introductory_promo_period: true


    enable_autopay:
      display-name: Enable autopay for a facility
      docs: Enables autopay for a facility
      path: /{facility_id}/enable_autopay
      path-parameters:
        facility_id: FacilityId
      method: POST
      request:
        name: EnableAutopayRequest
        body:
          properties:
            bank_account:
              type: commons.BankAccount
              docs: The bank account details to use for scheduled payments
            amount_type:
              type: commons.AutopayAmountType
              docs: The type of autopay amount, either minimum_payment or statement_balance
            additional_amount:
              type: optional<integer>
              docs: The additional amount to pay on top of the minimum payment, in cents (e.g. 1000 = $10.00)
      response: Facility
      errors:
        - commons.InvalidInputError
        - commons.FacilityNotFoundError
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
          request:
            bank_account: $commons.BankAccount.Default
            additional_amount: 0
            amount_type: statement_balance
          response:
            body: $Facility.AutopayEnabled

    disable_autopay:
      display-name: Disable autopay for a facility
      docs: Disable autopay for a facility
      path: /{facility_id}/disable_autopay
      path-parameters:
        facility_id: FacilityId
      method: POST
      response: Facility
      errors:
        - commons.AutopayAlreadyDisabledError
        - commons.FacilityNotFoundError
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
          response:
            body: $Facility.Active

    addRepaymentBankDetails:
      display-name: Add repayment bank details for a facility
      docs: Add repayment bank details for a facility
      path: /{facility_id}/repayment_bank_details
      path-parameters:
        facility_id: FacilityId
      method: POST
      request: commons.BankAccount
      response: Facility
      errors:
        - commons.InvalidInputError
        - commons.FacilityNotFoundError
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
          request: $commons.BankAccount.Default
          response:
            body: $Facility.Active

    get:
      display-name: Retrieve a facility
      docs: Retrieve a facility by its id
      path: /{facility_id}
      path-parameters:
        facility_id:
          type: FacilityId
          docs: The facility_id of the facility you want to retrieve
      method: GET
      response: Facility
      errors:
        - commons.InvalidFacilityIdError
        - commons.FacilityNotFoundError
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
          response:
            body: $Facility.Active

    listDisbursements:
      display-name: List all disbursements for your account
      docs: List disbursements for your account
      path: /disbursements
      method: GET
      response: list<Disbursement>
      examples:
        - response:
            body:
              - $Disbursement.Pending

    listStatementsForFacility:
      display-name: List statements for a facility
      docs: List statements for a facility
      path: /{facility_id}/statements
      path-parameters:
        facility_id:
          type: FacilityId
          docs: The facility_id of the facility you want to list statements for
      method: GET
      response: list<Statement>
      errors:
        - commons.InvalidFacilityIdError
        - commons.FacilityNotFoundError
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
          response:
            body:
              - $Statement.Default

    getDisbursementById:
      display-name: Retrieve a disbursement by its id
      docs: Retrieve a disbursement by its id
      path: /{facility_id}/disbursements/{disbursement_id}
      path-parameters:
        facility_id:
          type: FacilityId
          docs: The facility_id of the facility you want to retrieve
        disbursement_id:
          type: DisbursementId
          docs: The disbursement_id of the disbursement you want to retrieve
      method: GET
      response: Disbursement
      errors:
        - commons.InvalidDisbursementIdError
        - commons.DisbursementNotFoundError
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
            disbursement_id: $DisbursementId.Example0
          response:
            body: $Disbursement.Pending

    listDisbursementsForFacility:
      display-name: List disbursements for a facility
      docs: List disbursements for a facility
      path: /{facility_id}/disbursements
      path-parameters:
        facility_id:
          type: FacilityId
          docs: The facility_id of the facility you want to list disbursements for
      method: GET
      response: list<Disbursement>
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
          response:
            body:
              - $Disbursement.Pending

    listAll:
      display-name: List all facilities
      docs: List all facilities on your account
      path: ""
      method: GET
      response: list<Facility>
      examples:
        - response:
            body:
              - $Facility.Active

    getPayoffAmounts:
      display-name: Retrieve payoff amounts for a facility
      docs: Retrieve a list of payoff amount/date pairs for a facility for the next 10 days
      path: "/{facility_id}/payoff_amounts"
      path-parameters:
        facility_id:
          type: FacilityId
          docs: The facility_id of the facility you want to retrieve payoff amounts for
      method: GET
      response: PayoffAmounts
      errors:
        - commons.FacilityNotFoundError
      examples:
        - path-parameters:
            facility_id: $FacilityId.Example0
          response:
            body: $PayoffAmounts.Default

types:
  Transaction:
    union:
      disbursement: Disbursement
      payment: payments.Payment

  TransactionRefundResponse:
    properties:
      original:
        type: Transaction
        docs: The unique identifier of the transaction that was refunded
      refunded:
        type: RefundedTransaction
        docs: The unique identifier of the transaction that was refunded

  FacilityId:
    type: string
    examples:
      - name: Example0
        value: fac_18e5a3726b3943cda2635f40e1041ba4

  DisbursementId:
    type: string
    examples:
      - name: Example0
        value: dsb_18e5a3726b3943cda2635f40e1041ba4

  Statement:
    properties:
      id:
        type: string
        docs: The id of the statement
      statement_date:
        type: string
        docs: The end date of the statement (YYYY-MM-DD)
      statement_start_date:
        type: datetime
        docs: The start date of the statement (YYYY-MM-DD)
      balance_due:
        type: integer
        docs: The balance due at the time of statement creation, in cents
      current_principal_balance:
        type: integer
        docs: The principal balance of the statement, in cents
      current_interest_balance:
        type: integer
        docs: The interest balance of the statement, in cents
      interest_charged:
        type: integer
        docs: The interest balance of the statement, in cents
      due_date:
        type: string
        docs: The due date of the statement (YYYY-MM-DD)
      transactions:
        type: FacilityTransactionItems
        docs: An array of transactions made (scoped to the period of the statement)
      payments:
        type: list<payments.Payment>
        docs: An array of payments made (scoped to the period of the statement)
      disbursements:
        type: list<Disbursement>
        docs: An array of disbursements made (scoped to the period of the statement)
      facility_id: FacilityId
      url:
        type: string
        docs: The url of the statement pdf
      created_on:
        type: datetime
        docs: Timestamp the statement object is created on
    examples:
      - name: Default
        value:
          id: stmt_deb6aba913d84feb987934f50c32bf03
          statement_date: 2023-03-17
          facility_id: $FacilityId.Example0
          url: https://app.docspring.com/submissions/sub_gjX2LS7c6FjqZt12hQ/download
          created_on: 2023-02-27T00:00:00Z
          statement_start_date: 2024-06-17T00:00:00.000Z
          balance_due: 500000
          current_principal_balance: 500000
          current_interest_balance: 10000
          interest_charged: 0
          due_date: 2023-03-17
          transactions: $FacilityTransactionItems.Default
          payments:
            - $payments.Payment.Settled
          disbursements:
            - $Disbursement.Pending

  Disbursement:
    properties:
      id:
        type: string
        docs: The id of the disbursement
      facility_id: FacilityId
      amount:
        type: integer
        docs: The amount of the disbursement, in cents (e.g. 1000 = $10.00)
      status:
        type: commons.TransferStatus
        docs: The status of the disbursement
      failure_reason:
        type: optional<string>
        docs: A reason for the failure if any exists
      date:
        type: optional<string>
        docs: The date of the disbursement (YYYY-MM-DD)
      created_on:
        type: datetime
        docs: Timestamp the disbursement object is created on
      transfer_type:
        type: commons.TransferType
        docs: The type of transfer to use for the disbursement
    examples:
      - name: Pending
        value:
          id: $DisbursementId.Example0
          facility_id: $FacilityId.Example0
          amount: 100000
          status: pending
          failure_reason: null
          date: 2023-02-27
          created_on: 2023-02-27T00:00:00Z
          transfer_type: standard
      - name: PendingNoneType
        value:
          id: $DisbursementId.Example0
          facility_id: $FacilityId.Example0
          amount: 100000
          status: pending
          failure_reason: null
          date: 2023-02-27
          created_on: 2023-02-27T00:00:00Z
          transfer_type: none

  DisbursementRequest:
    properties:
      amount:
        type: integer
        docs: The amount of the disbursement, in cents (e.g. 1000 = $10.00)
      disbursement_bank_account:
        type: optional<commons.BankAccount>
        docs: The bank account to disburse to
      transfer_type:
        type: commons.TransferType
        docs: The type of transfer to use for the disbursement
    examples:
      - name: Default
        value:
          amount: 100000
          disbursement_bank_account: $commons.BankAccount.Default
          transfer_type: standard
      - name: DefaultNoneType
        value:
          amount: 100000
          transfer_type: none

  Document:
    properties:
      document_url:
        type: string
        docs: The URL where the document can be accessed.
      id:
        type: string
        docs: The unique identifier for the document.
    examples:
      - name: ExampleDocument
        value:
          document_url: "https://example.com/document.pdf"
          id: "doc_1234567890abcdef"

  FacilityDocument:
    properties:
      document_url:
        type: string
        docs: The URL where the document can be accessed.
      document_id:
        type: string
        docs: The unique identifier for the document.
    examples:
      - name: ExampleDocument
        value:
          document_url: "https://example.com/document.pdf"
          document_id: "doc_1234567890abcdef"

  Documents:
    properties:
      unsigned_credit_agreement:
        type: optional<FacilityDocument>
        docs: The URL and ID for the unsigned credit agreement document.
      signed_credit_agreement:
        type: optional<FacilityDocument>
        docs: The URL and ID for the signed credit agreement document.
      unsigned_ach_authorization:
        type: optional<FacilityDocument>
        docs: The URL and ID for the unsigned ACH authorization document.
      unsigned_autopay_ach_authorization:
        type: optional<FacilityDocument>
        docs: The URL and ID for the unsigned autopay ACH authorization document.
      signed_ach_authorization:
        type: optional<FacilityDocument>
        docs: The URL and ID for the signed ACH authorization document.
      signed_autopay_ach_authorization:
        type: optional<FacilityDocument>
        docs: The URL and ID for the signed autopay ACH authorization document.
    examples:
      - name: ExampleDocuments
        value:
          unsigned_credit_agreement:
            document_url: "https://storage.googleapis.com/example/unsigned_credit_agreement.pdf"
            document_id: "doc_1234567890abcdef"
          signed_credit_agreement:
            document_url: "https://storage.googleapis.com/example/signed_credit_agreement.pdf"
            document_id: "doc_abcdef1234567890"
          unsigned_ach_authorization:
            document_url: "https://storage.googleapis.com/example/unsigned_ach_authorization.pdf"
            document_id: "doc_fedcba9876543210"
          unsigned_autopay_ach_authorization:
            document_url: "https://storage.googleapis.com/example/unsigned_autopay_ach_authorization.pdf"
            document_id: "doc_0123456789abcdef"
          signed_ach_authorization:
            document_url: "https://storage.googleapis.com/example/signed_ach_authorization.pdf"
            document_id: "doc_fedcba0987654321"
          signed_autopay_ach_authorization:
            document_url: "https://storage.googleapis.com/example/signed_autopay_ach_authorization.pdf"
            document_id: "doc_0123456789abcdef"

  FacilityBalances:
    properties:
      current_balance:
        type: integer
        docs: The current balance of the loan, in cents (includes everything - principal, interest, fees, etc.)
      principal_balance:
        type: integer
        docs: The principal balance of the loan, in cents
      interest_balance:
        type: integer
        docs: The interest balance of the loan, in cents
      payoff_balance:
        type: integer
        docs: The payoff balance of the loan, in cents (if the facility is in grace then this balance is only principal; otherwise it matches current_balance)
    examples:
      - name: Default
        value:
          current_balance: 500000
          principal_balance: 500000
          interest_balance: 0
          payoff_balance: 500000

  Facility:
    properties:
      id: FacilityId
      application_id:
        type: applications.ApplicationId
        docs: > 
          The `application_id` of the corresponding loan application for the
          facility
      borrower_id:
        type: borrowers.ConsumerBorrowerId
        docs: The `borrower_id` of the corresponding borrower the facility is for
      loan_agreement_id:
        type: string
        docs: >
          The `loan_agreement_id` of the corresponding loan agreement the facility
          is for
      credit_type:
        type: commons.CreditType
        docs: The type of credit production.
      created_on:
        type: datetime
        docs: Timestamp the loan agreement object is created on
      status:
        type: CreditStatus
        docs: The status of the facility.
      account_number:
        type: string
        docs: The account number of the credit facility
      amortization_schedule:
        type: optional<AmmortizationSchedules>
        docs: The amortization schedule of the loan
      repayment_bank_details:
        type: optional<commons.BankAccount>
        docs: The bank account information used to repay the loan
      transactions:
        type: FacilityTransactionItems
        docs: An array of transactions made (empty if no payments are due)
      statements:
        type: list<Statement>
        docs: An array of statements for the loan (empty if no statements exist)
      balance:
        type: optional<integer>
        docs: The remaining balance of the loan, in cents
      balances:
        type: FacilityBalances
        docs: A deeper view of what makes up the facility balance, all in cents
      interest_balance:
        type: optional<integer>
        docs: The current interest balance of the loan, in cents (deprecated - see balances field)
        availability: deprecated
      payoff_balance:
        type: optional<integer>
        docs: The current payoff balance of the loan, in cents (deprecated - see balances field)
        availability: deprecated
      origination_date:
        type: optional<string>
        docs: The date the loan was originated (YYYY-MM-DD)
      disbursement_date:
        type: optional<string>
        docs: The date the loan was disbursed (YYYY-MM-DD)
      remaining_term:
        type: optional<integer>
        docs: The remaining term of the loan, in months
      payments_due:
        type: PaymentsDue
        docs: An array of payments due (empty if no payments are due)
      next_payment_amount:
        type: optional<integer>
        docs: The amount of the next payment, in cents
      next_payment_due_date:
        type: optional<string>
        docs: The date the next payment is due (YYYY-MM-DD)
      current_payment_due_date:
        type: optional<string>
        docs: The date the current payment is due (YYYY-MM-DD)
      last_payment_date:
        type: optional<string>
        docs: The date the last payment was made (YYYY-MM-DD)
      principal_paid_thru:
        type: optional<string>
        docs: The date the principal is paid through (YYYY-MM-DD)
      next_billing_date:
        type: optional<string>
        docs: The next billing date of the loan (YYYY-MM-DD)
      interest_accrued_thru:
        type: optional<string>
        docs: The date the interest is accrued through (YYYY-MM-DD)
      next_accrual_cutoff_date:
        type: optional<string>
        docs: The next accrual cutoff date of the loan (YYYY-MM-DD)
      scheduled_payoff_date:
        type: optional<string>
        docs: The scheduled payoff date of the loan (YYYY-MM-DD)
      terms:
        type: applications.Offer
        docs: An object containing a summary of the terms of the facility.
      autopay:
        type: optional<commons.Autopay>
        docs: Whether or not autopay is enabled for the facility.
      documents:
        type: optional<Documents>
        docs: The documents associated with the facility
      remaining_statement_balance:
        type: integer
        docs: The amount, in cents, of the last statement balance, less any payments made after the statement was created. Will be set to null until first statement is created.
      remaining_minimum_balance:
        type: integer
        docs: The minimum due, in cents, of the last statement minimum, less any payments made since the statement was created. Will be set to null until first statement is created.
      last_statement_info:
        type: optional<LastStatementInfo>
        docs: The last statement information including date/amount.
      in_grace_period:
        type: optional<boolean>
        docs: Whether the facility is in a grace period
      in_introductory_promo_period:
        type: optional<boolean>
        docs: Whether the facility is in an introductory promotional period
    examples:
      - name: Active
        value:
          terms: $applications.Offer.Loan
          id: $FacilityId.Example0
          application_id: $applications.ApplicationId.Example0
          borrower_id: $borrowers.ConsumerBorrowerId.Default
          loan_agreement_id: $loan-agreements.LoanAgreementId.Example0
          credit_type: consumer_installment_loan
          status: active
          created_on: "2023-05-12T19:46:09.293Z"
          account_number: "401542198"
          balance: 500000
          balances: $FacilityBalances.Default
          interest_balance: 0
          payoff_balance: 500000
          origination_date: "2023-05-12"
          disbursement_date: "2023-05-12"
          remaining_term: 48
          payments_due: $PaymentsDue.Default
          amortization_schedule: $AmmortizationSchedules.Default
          repayment_bank_details: $commons.BankAccount.Default
          transactions: $FacilityTransactionItems.Default
          statements:
            - $Statement.Default
          next_payment_amount: 124425
          next_payment_due_date: "2023-06-12"
          current_payment_due_date: "2023-06-12"
          last_payment_date: null
          principal_paid_thru: "2023-05-11"
          next_billing_date: "2023-05-28"
          interest_accrued_thru: "2023-05-11"
          next_accrual_cutoff_date: "2023-06-11"
          scheduled_payoff_date: "2027-05-12"
          autopay: $commons.Autopay.Disabled
          documents: $Documents.ExampleDocuments
          remaining_statement_balance: 7500
          remaining_minimum_balance: 7500
          last_statement_info: $LastStatementInfo.Default
          in_grace_period: false
          in_introductory_promo_period: false
      - name: AutopayEnabled
        value:
          terms: $applications.Offer.Loan
          id: $FacilityId.Example0
          application_id: $applications.ApplicationId.Example0
          borrower_id: $borrowers.ConsumerBorrowerId.Default
          loan_agreement_id: $loan-agreements.LoanAgreementId.Example0
          credit_type: consumer_installment_loan
          status: active
          created_on: "2023-05-12T19:46:09.293Z"
          account_number: "401542198"
          balance: 500000
          balances: $FacilityBalances.Default
          interest_balance: 0
          payoff_balance: 500000
          origination_date: "2023-05-12"
          disbursement_date: "2023-05-12"
          remaining_term: 48
          payments_due: $PaymentsDue.Default
          amortization_schedule: $AmmortizationSchedules.Default
          repayment_bank_details: null
          transactions: $FacilityTransactionItems.Default
          statements:
            - $Statement.Default
          next_payment_amount: 124425
          next_payment_due_date: "2023-06-12"
          current_payment_due_date: "2023-06-12"
          last_payment_date: null
          principal_paid_thru: "2023-05-11"
          next_billing_date: "2023-05-28"
          interest_accrued_thru: "2023-05-11"
          next_accrual_cutoff_date: "2023-06-11"
          scheduled_payoff_date: "2027-05-12"
          autopay: $commons.Autopay.Default
          remaining_statement_balance: 7500
          remaining_minimum_balance: 7500
          last_statement_info: $LastStatementInfo.Default
          in_grace_period: false
          in_introductory_promo_period: false
      - name: Closed
        value:
          terms: $applications.Offer.Loan
          id: $FacilityId.Example0
          application_id: $applications.ApplicationId.Example0
          borrower_id: $borrowers.ConsumerBorrowerId.Default
          loan_agreement_id: $loan-agreements.LoanAgreementId.Example0
          credit_type: consumer_installment_loan
          created_on: "2023-01-17T04:59:21.773Z"
          status: closed
          account_number: "401542198"
          balance: 500000
          balances: $FacilityBalances.Default
          interest_balance: 0
          payoff_balance: 500000
          origination_date: "2023-05-12"
          disbursement_date: "2023-05-12"
          remaining_term: 48
          payments_due: []
          amortization_schedule: []
          repayment_bank_details: $commons.BankAccount.Default
          transactions: []
          statements: []
          next_payment_amount: 124425
          next_payment_due_date: "2023-06-12"
          current_payment_due_date: "2023-06-12"
          last_payment_date: null
          principal_paid_thru: "2023-05-11"
          next_billing_date: "2023-05-28"
          interest_accrued_thru: "2023-05-11"
          next_accrual_cutoff_date: "2023-06-11"
          scheduled_payoff_date: "2027-05-12"
          autopay: $commons.Autopay.Disabled
          remaining_statement_balance: 7500
          remaining_minimum_balance: 7500
          last_statement_info: $LastStatementInfo.Default
          in_grace_period: false
          in_introductory_promo_period: false

  LastStatementInfo:
    properties:
      last_statement_date:
        type: string
        docs: The date of the last statement (2024-06-01T00:00:00.000Z)
      last_statement_amount:
        type: integer
        docs: The amount of the last statement, in cents
    examples:
      - name: Default
        value:
          last_statement_date: "2024-06-01T00:00:00.000Z"
          last_statement_amount: 47000

  LimitReductionReasons:
    enum:
        - change_in_credit_score
        - high_credit_utilization
        - late_payments
        - inactivity
        - economic_downturn
        - negative_changes_in_financial_situation
        - increased_debt_levels
        - credit_report_changes
        - regulatory_or_internal_policy_changes
        - fraud_prevention

  CreditStatus:
    enum:
      - active
      - closed

  FacilityTransactionItem:
    properties:
      amount:
        type: integer
        docs: The amount of the transaction, in cents (e.g. 1000 = $10.00)
      net_amount:
        type: integer
        docs: The net amount of the transaction, meaning positive or negative depending on the effect on the ledger, in cents (e.g. 1000 = $10.00)
      transaction_date:
        type: string
        docs: The date of the transaction (YYYY-MM-DD)
      effective_date:
        type: string
        docs: The effective date of the transaction (YYYY-MM-DD)
      description:
        type: string
        docs: A description of the transaction
      transaction_type:
        type: FacilityTransactionType
        docs: The type of transaction relative to the effect on the balance (CREDIT = balance decrease; DEBIT = balance increase; NONE = no balance change)
      transaction_iso_timestamp:
        type: datetime
        docs: The ISO timestamp of the transaction

  FacilityTransactionType:
    enum:
      - NONE
      - CREDIT
      - DEBIT

  FacilityTransactionItems:
    type: list<FacilityTransactionItem>
    examples:
      - name: Default
        value:
          - amount: 100000
            net_amount: 100000
            transaction_date: "2023-05-12"
            effective_date: "2023-05-12"
            description: "Disbursement"
            transaction_type: "DEBIT"
            transaction_iso_timestamp: "2023-05-12T00:00:00.000Z"
          - amount: 500000
            net_amount: -500000
            transaction_date: "2024-06-02"
            effective_date: "2024-06-02"
            description: "Principal Reduction"
            transaction_type: "CREDIT"
            transaction_iso_timestamp: "2023-05-12T00:00:00.000Z"

  PaymentDue:
    properties:
      payment_amount:
        type: integer
        docs: The amount of the payment, in cents (e.g. 1000 = $10.00)
      payment_amount_remaining:
        type: integer
        docs: The amount of the payment remaining, in cents (e.g. 1000 = $10.00)
      payment_due_date:
        type: string
        docs: The date the payment is due (YYYY-MM-DD)

  PaymentsDue:
    type: list<PaymentDue>
    examples:
      - name: Default
        value:
          - payment_amount: 123456
            payment_amount_remaining: 123456
            payment_due_date: "2023-06-12"

  PayoffAmount:
    properties:
      amount:
        type: integer
        docs: The amount of the payoff, in cents (e.g. 1000 = $10.00)
      date:
        type: string
        docs: The date the payoff is due (YYYY-MM-DD)
    examples:
      - name: Default
        value:
          amount: 100000
          date: "2023-05-12"

  PayoffAmounts:
    type: list<PayoffAmount>
    examples:
      - name: Default
        value:
          - amount: 504889
            date: "2023-12-08"
          - amount: 505112
            date: "2023-12-09"
          - amount: 505334
            date: "2023-12-10"
          - amount: 505556
            date: "2023-12-11"
          - amount: 505778
            date: "2023-12-12"
          - amount: 506001
            date: "2023-12-13"
          - amount: 506223
            date: "2023-12-14"
          - amount: 506445
            date: "2023-12-15"
          - amount: 506667
            date: "2023-12-16"
          - amount: 506866
            date: "2023-12-17"

  AmmortizationSchedules:
    type: list<AmortizationSchedule>
    examples:
      - name: Default
        value:
          - $AmortizationSchedule.Default0
          - $AmortizationSchedule.Default1

  TransactionId:
    union:
      disbursementId: DisbursementId
      paymentId: payments.PaymentId

  RefundMetadata:
    properties:
      original_payment_id:
        type: optional<payments.PaymentId>
        docs: The id of the original payment that was refunded
      original_disbursement_id:
        type: optional<DisbursementId>
        docs: The id of the original disbursement that was refunded
      memo:
        type: optional<string>
        docs: A memo about the refund

  RefundedDisbursement:
    extends: Disbursement
    properties:
      refund_metadata:
        type: RefundMetadata
        docs: Metadata about the original transaction being refunded

  RefundedPayment:
    extends: payments.Payment
    properties:
      refund_metadata:
        type: RefundMetadata
        docs: Metadata about the original transaction being refunded

  RefundedTransaction:
    union:
      disbursement: RefundedDisbursement
      payment: RefundedPayment

  AmortizationSchedule:
    properties:
      payment_date:
        type: string
        docs: The date of this payment in the schedule
      interest_payment_amount:
        type: integer
        docs: The amount in cents of the payment going towards interest (e.g. 0 is $0.00)
      principal_payment_amount:
        type: integer
        docs: The amount in cents of the payment going towards principal (e.g. 8333 is $83.33)
      other_payment_amount:
        type: integer
        docs: Any other payments in cents to be made (e.g. 0 is $0.00)
      total_payment_amount:
        type: integer
        docs: The total payment in cents to be made comprised of all of the other payment amount fields (e.g. 8333 is $83.33)
      balance_amount:
        type: integer
        docs: The balance in cents that is left after making the `total_payment_amount` (e.g. 91667 is $916.67)
      item_index:
        type: integer
        docs: The number representing the order of the item in the list (one based)
    examples:
      - name: Default0
        value:
          payment_date: "2023-11-02"
          interest_payment_amount: 0
          principal_payment_amount: 8333
          other_payment_amount: 0
          total_payment_amount: 8333
          balance_amount: 91667
          item_index: 1
      - name:  Default1
        value:
          payment_date: "2023-12-02"
          interest_payment_amount: 0
          principal_payment_amount: 8333
          other_payment_amount: 0
          total_payment_amount: 8333
          balance_amount: 83334
          item_index: 2
